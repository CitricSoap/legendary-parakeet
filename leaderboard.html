<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Leaderboard — Legendary Parakeet</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header class="site-header">
    <h1>Legendary Parakeet — Leaderboard</h1>
    <a href="/">Back to App</a>
  </header>
  <main style="max-width:900px;margin:20px auto;padding:16px">
    <section class="game-card">
      <h2>Top Scores</h2>
      <div style="display:flex;gap:8px;align-items:center;margin-bottom:12px">
        <button id="refresh">Refresh</button>
        <button id="download">Download JSON</button>
        <button id="clear" style="background:#e05a5a">Clear Scores (requires login)</button>
      </div>
      <div id="list"></div>
    </section>
  </main>
  <script>
  async function fetchList(){
    const res = await fetch('/api/leaderboard');
    const arr = await res.json();
    const list = document.getElementById('list'); list.innerHTML='';
    if(!arr || arr.length===0){ list.textContent='No scores yet'; return; }
    arr.forEach((r,i)=>{ const div=document.createElement('div'); div.style.padding='8px'; div.style.borderBottom='1px solid #eee'; div.textContent = `${i+1}. ${r.username||'anon'} — ${r.score}`; list.appendChild(div); });
  }
  document.getElementById('refresh').addEventListener('click', fetchList);
  document.getElementById('download').addEventListener('click', async ()=>{ const res=await fetch('/api/leaderboard'); const j=await res.json(); const blob=new Blob([JSON.stringify(j, null, 2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='leaderboard.json'; a.click(); URL.revokeObjectURL(url); });
  document.getElementById('clear').addEventListener('click', async ()=>{
    if(!confirm('Clear all scores? Requires login.')) return;
    const token = localStorage.getItem('lp_token');
    if(!token){ alert('You must be logged in to clear scores'); return; }
    const res = await fetch('/api/leaderboard/clear',{method:'POST', headers:{'Authorization':'Bearer '+token}});
    if(res.ok){ alert('Cleared'); fetchList(); } else { alert('Failed'); }
  });
  fetchList();
  </script>
</body>
</html>
